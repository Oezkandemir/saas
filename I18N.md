# i18n Automation for Next-SaaS-Stripe-Starter

This project uses the inlang ecosystem for internationalization (i18n) and automated translation processes.

## Setup

The project is configured with inlang for i18n management. The configuration can be found in `project.inlang/settings.json`.

## Translation Files

Translation files are stored in the `messages` directory with one file per language:
- `messages/en.json` - English (source language)
- `messages/de.json` - German (target language)

## Adding New Translations

When adding new text to the application:

1. Always add new keys to the source language file (`messages/en.json`) first
2. Use a structured hierarchy (like `Section.subsection.element`)
3. Run the translation command to generate translations for other languages

## Commands

### Local Development

These commands are available in the package.json scripts:

```bash
# Synchronize translation keys (add missing keys from target languages to source)
npm run i18n:sync

# Validate your inlang configuration
npm run i18n:validate

# Machine translate missing translations
npm run i18n:translate
```

### Recommended Workflow

A common workflow would be:

1. Run `npm run i18n:sync` to make sure the source language has all keys
2. Run `npm run i18n:translate` to update all other languages with translations
3. Manually review and edit machine translations if needed

### Manual Commands

You can also run the following commands directly:

```bash
# Validate inlang project
npx @inlang/cli@latest validate --project ./project.inlang

# Machine translate English to German
npx @inlang/cli@latest machine translate --project ./project.inlang --locale en --targetLocales de

# Check for differences between language files (using Unix tools)
grep -o "\"[^\"]*\"\\s*:" messages/en.json | sort > en_keys.txt
grep -o "\"[^\"]*\"\\s*:" messages/de.json | sort > de_keys.txt
diff en_keys.txt de_keys.txt
# or to see keys in de.json not in en.json:
comm -23 de_keys.txt en_keys.txt
```

## Automated Workflow

A GitHub Actions workflow is set up in `.github/workflows/i18n.yml` to automatically:

1. Validate the inlang configuration
2. Machine translate missing translations
3. Create a pull request with the updates

This workflow runs:
- On push to the main branch
- Manually via workflow_dispatch

## Key Synchronization Script

The project includes a custom Node.js script (`scripts/i18n-sync.js`) that helps maintain consistency between language files:

- It scans all language files in the `messages` directory
- It identifies any keys in target languages (e.g., `de.json`) that don't exist in the source language (`en.json`)
- It automatically adds those keys to the source language file, copying values from the target language
- This ensures the source language has a complete set of keys, which is required for inlang to work properly

Run this script with `npm run i18n:sync` before running `npm run i18n:translate` to ensure all keys are properly synchronized.

## Best Practices

1. Always review machine translations before merging
2. Keep translation keys organized and descriptive
3. Use ICU message format for complex translation needs
4. Use variables for dynamic content
5. **Always add new strings to the source language first** - the source language file should be the "source of truth"
6. Don't use string concatenation - use translation parameters instead
7. If you find keys in target languages that don't exist in the source, run `npm run i18n:sync` to automatically add them

## Troubleshooting

If translations aren't working as expected:

1. Validate your configuration: `npm run i18n:validate`
2. Check that your translation files are correctly formatted
3. Ensure sourceLanguageTag and languageTags are correctly configured
4. Check that modules and plugins are correctly specified
5. Run `npm run i18n:sync` to ensure all keys in target languages exist in the source language

### Common Errors

- **"Source locale not found in the bundle"**: This typically happens when there are keys in the target language files (like de.json) that don't exist in the source language file (en.json). The standard approach is that your source language should contain ALL translation keys, and target languages may have a subset of those keys that will be translated. Fix by:
  - Running `npm run i18n:sync` to automatically add missing keys
  - Manually comparing keys between files: `grep -o "\"[^\"]*\"\\s*:" messages/en.json | sort > en_keys.txt && grep -o "\"[^\"]*\"\\s*:" messages/de.json | sort > de_keys.txt && diff en_keys.txt de_keys.txt`
  - Adding any missing keys from the target language back to the source language

## Resources

- [inlang CLI Documentation](https://inlang.com/m/2qj2w8pu/app-inlang-cli)
- [Next-intl Plugin](https://inlang.com/m/193hsyds/plugin-inlang-nextIntl) 